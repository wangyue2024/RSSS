### 第一部分：做市商 (Market Maker) 的策略设计

在你的架构中，做市商不应该是一个“预测涨跌”的赌徒，而应该是一个 **“提供双边报价，赚取点差，管理库存风险”** 的服务商。

我推荐采用经典的  **Inventory-Based Strategy (基于库存的做市策略)** ，这是高频交易中最基础且有效的模型（参考 Avellaneda-Stoikov 模型）。

# 预热期数据生成和来源：

预热期


#### 方案 A：几何布朗运动 (GBM) —— 纯数学模拟 (推荐)

这是最简单、独立性最强的方法。不需要外部文件，直接在 Rust `Host` 初始化时生成。

* **原理** ：价格服从随机游走，带有一定的漂移项（Drift）和波动率（Volatility）。
* **公式** ：**$P_{t} = P_{t-1} \cdot e^{(\mu - \frac{\sigma^2}{2})\Delta t + \sigma \epsilon}$**
* **Rust 实现逻辑** ：

1. 在系统启动时（Tick 0 之前），Rust 内部生成一个长度为 N (如 200) 的 `Vec<f64>`。
2. 设定初始价格 **$P_0 = 100.0$**。
3. 循环 200 次，利用 `rand::Normal` 生成随机扰动，计算出 **$P_1$** 到 **$P_{200}$**。
4. 将这 200 个价格直接写入 `market.history_prices`。
5. 根据这 200 个价格，预计算出 `ma_20`, `rsi_14` 的初始值。

* **优点** ：系统闭环，无需外部依赖，每次运行都不一样。
* 

#### 方案 B：外部历史数据回放 (Replay) —— 追求真实

如果你有真实的 Level-1 分笔数据（Tick Data）。

* **逻辑** ：

1. 读取 CSV 文件。
2. 取前 200 行数据的价格填充 `history_prices`。
3. **衔接问题 (The Hard Cut)** ：这是最大风险。
   * Tick 200 (历史数据) 价格是 100.0。
   * Tick 201 (仿真开始) Agent 根据策略开始买卖。
   * 如果你的 MM 策略没有校准好，可能 Tick 201 的撮合价格突然跳到 105.0。这种**断层**会瞬间触发所有止损盘。

* **解决** ：如果用方案 B，必须让 Tick 201 的做市商以 Tick 200 的历史价格为基准开始报价。




| **策略流派**                     | **典型逻辑**                                 | **现有数据 (v0.3)** | **缺口 / 痛点**                                                |
| -------------------------------------- | -------------------------------------------------- | ------------------------- | -------------------------------------------------------------------- |
| **A. 动量/趋势 (Momentum)**      | "价格突破过去 20 tick 的最高点就追涨"              | MA, Price                 | **缺 High/Low** 。目前只有均价，无法判断“突破前高”。         |
| **B. 量价分析 (Volume)**         | "放量上涨才是真涨，缩量上涨是诱多"                 | Volume (当前Tick)         | **缺 Volume History** 。无法计算“成交量是否放大”。           |
| **C. 微观结构 (Microstructure)** | "卖一挂单突然消失（撤单），且上一笔是大单主动买入" | Top 5 Bids/Asks           | **缺 Last Trade Direction** 。不知道上一笔是主动买还是主动卖。 |
| **D. 机构算法 (VWAP/TWAP)**      | "我的买入价必须低于当天的成交量加权均价"           | 无                        | **缺 VWAP** 。这是机构考核的核心指标。                         |
| **E. 波动率策略 (Volatility)**   | "波动率极低时埋伏，突破 ATR 止损"                  | `std_dev`               | **缺 ATR (真实波幅)** 。StdDev 反应慢，ATR 对跳空更敏感。      |
| **F. 摆荡策略 (Oscillator)**     | "KD 指标金叉"                                      | RSI                       | **缺 RSV/KD** 。RSI 只能看超买超卖，KD 能看交叉信号。          |
